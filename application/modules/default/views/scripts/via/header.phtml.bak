<?php
    $id = 'space_menubar';
    
    $this->headScript()->appendFile($this->internal->vars->static_host . '/js/yui/yui2/build/yahoo-dom-event/yahoo-dom-event.js');
    $this->headScript()->appendFile($this->internal->vars->static_host . '/js/yui/yui2/build/container/container-min.js');
    $this->headScript()->appendFile($this->internal->vars->static_host . '/js/yui/yui2/build/animation/animation-min.js');
    $this->headScript()->appendFile($this->internal->vars->static_host . '/js/yui/yui2/build/menu/menu-min.js');
    $this->headScript()->appendFile($this->internal->vars->static_host . '/js/vm/yui/menu_anim.js');
?>

<h1>You are in <?= $this->internal->via->name ?>'s space.</h1>

<?php $this->inlineScript()->captureStart() ?>
YAHOO.util.Event.onContentReady("<?= $id ?>", function () {
    var o<?= $id ?> = new YAHOO.widget.MenuBar("<?= $id ?>", {
            autosubmenudisplay: true,
            hidedelay: 750,
            lazyload: true });
    o<?= $id ?>.subscribe("beforeShow", onSubmenuBeforeShow);
    o<?= $id ?>.subscribe("show", onSubmenuShow);
    o<?= $id ?>.render();
    o<?= $id ?>.show();           
});
<?php $this->inlineScript()->captureEnd() ?>

<div id="<?= $id ?>" class="yuimenubar yuimenubarnav" style="visiblity: hidden;">

    <div class="bd">
        <ul class="first-of-type">
            <li class="yuimenubaritem first-of-type"><a href="<?= $this->internal->target->pre ?>/" class="yuimenubaritemlabel">Home</a>
<?php if ($this->internal->target->acl->privilege >= ViaMe_Controller_Action::ACL_OWNER) { ?>
                <div class="yuimenu"><div class="bd"><ul>
                    <li class="yuimenuitem"><a href="<?= $this->internal->target->pre ?>/module/add/" class="yuimenuitemlabel"><em><b>+ Add A New Module</b></em></a></li>
                    <li class="yuimenuitem"><a href="<?= $this->internal->target->pre ?>/widget/add/" class="yuimenuitemlabel"><em><b>+ Add A New Widget</b></em></a></li>
                </ul></div></div>
<?php } ?>
            </li>
<?php
if (isset($this->internal->target->modules)) {
    // Load up which modules have sublinks
    $modules_with_subs = array();
    foreach ($this->internal->target->modules as $module) {
        if (isset($module->display_stack) && $module->display_stack != 'none' && (!($module->display_stack === null))) {
            $modules_with_subs[$module->display_stack] = true;
        }
    }
    
    _displayLinks($this->internal->target->modules, null, $this->internal, $modules_with_subs, false);
}

function _displayLinks($modules, $stack, $internal, $modules_with_subs, $display_new_list = true) {
    $new_list_displayed = false;
    
    if (isset($modules)) {
        foreach ($modules as $module) {
            if ($module->display_stack == $stack) {
                if ($internal->target->acl->owner ||
                    $module->allowed === null ||
                    $module->show_on_fail ||
                    ($module->allowed && ($module->privilege > 0)) ||
                    ($internal->target->acl->recursive && ($internal->target->acl->privilege > 0))) {
                    
                    if ($display_new_list && !$new_list_displayed) {
                        echo '<div class="yuimenu"><div class="bd"><ul>';
                        $new_list_displayed = true;
                    }
                    
                    echo '<li class="' . (!$stack ? 'yuimenubaritem' : 'yuimenuitem') . '">';
                    echo '<a href=" ' . $internal->target->pre . '/' . $module->m_name . '/p/mid/' . $module->counter . '/" class="' . (!$stack ? 'yuimenubaritemlabel' : 'yuimenuitemlabel') . '">' . ($module->display ? $module->display : $module->m_display) . '</a>';
                    $display_stack = $module->module_id . '-' . $module->counter;
                    if (isset($modules_with_subs[$display_stack]) && $modules_with_subs[$display_stack]) {
                        _displayLinks($modules, $display_stack, $internal, $modules_with_subs, true);
                    }
                    echo '</li>';
                }
            }
        }
        
        if ($new_list_displayed) {
            echo '</ul></div></div>';
        }
    }
}
?>
            
        </ul>            
    </div>

</div>


<?php /*

<?php
$this->headScript()->appendFile($this->internal->vars->static_host . '/js/yui/yui2/build/yuiloader/yuiloader.js');
$this->inlineScript()->captureStart() ?>
var loader = new YAHOO.util.YUILoader();
loader.insert({
    require: ['tabview'],
    base: '<?= $this->internal->vars->static_host ?>/js/yui/yui2/build/',
    //filter: 'DEBUG',
    loadOptional: false
});
<?php $this->inlineScript()->captureEnd() ?>

<h1>You are in <?= $this->internal->via->name ?>'s space.</h1>

<div id="demo" class="yui-navset">
    <ul class="yui-nav">
        <li<?= (!isset($this->internal->params->submodule) || $this->internal->params->submodule == '' ? ' class="selected"' : '') ?>><a href="<?= $this->internal->target->pre ?>/"><em>Home</em></a></li>
<?php
if (isset($this->internal->target->modules)) {
    foreach ($this->internal->target->modules as $module) {
        if ($this->internal->target->acl->owner ||
            $module->allowed === null ||
            $module->show_on_fail ||
            ($module->allowed && ($module->privilege > 0)) ||
            ($this->internal->target->acl->recursive && ($this->internal->target->acl->privilege > 0))) {
?>
        <li<?= (isset($this->internal->params->submodule) && $this->internal->params->submodule == $module->m_name && isset($this->internal->params->mid) && $this->internal->params->mid == $module->counter ? ' class="selected"' : '') ?>><a href="<?= $this->internal->target->pre ?>/<?= $module->m_name ?>/p/mid/<?= $module->counter ?>/"><em><?= ($module->display ? $module->display : $module->m_display) ?></em></a></li>
<?php
        }
    }
}
?>
        <li><a href="<?= $this->internal->target->pre ?>/module/add/"><em><b>+ Add A New Module</b></em></a></li>
    </ul>            
    <div class="yui-content">
<?php
    if (isset($this->internal->params->submodule)
        && array_key_exists($this->internal->params->submodule, $this->module_modules)) {
        
        #echo $this->action(
        #    (isset($this->internal->params->subaction) ? $this->internal->params->subaction : 'index'),
        #    (isset($this->internal->params->subcontroller) ? $this->internal->params->subcontroller : 'index'),
        #    ($this->internal->params->submodule),
        #    (array) $this->internal->params
        #);
    }
    else {
?>
        content
<?php
    }
?>
    </div>
</div>

*/ ?>